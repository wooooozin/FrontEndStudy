<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <!-- <script defer src="./main.js"></script> -->
  <!-- <script defer src="./func.js"></script> -->
  <!-- <script defer src="./class.js"></script> -->
  <!-- <script defer src="./class-in.js"></script> -->
  <!-- <script defer src="./data-1.js"></script> -->
  <!-- <script src="./data-2.js"></script> -->
  <!-- <script src="./array.js"></script> -->
  <!-- <script src="./object.js"></script> -->
<!-- <script src="./data3.js"></script> -->
<!-- <script src="./lodash.js"></script> -->
<!-- <script src="./json.js"></script> -->
<!-- <script src="./storage.js"></script> -->
<!-- <script defer src="./api.js"></script> -->
<style>
  html,body {margin:0;padding:0;box-sizing:border-box;}
  .agree-area {border:1px solid red;}
  .agree-area .acco {background:#fafafa;}
  .agree-area .acco .panel {display:none;}
  .agree-area .acco.-active .panel {display:block;}
  .agree-area .acco .title {padding:10px;font-size:16px;font-weight:bold;box-sizing:border-box;border:1px solid #000;}
  .agree-area .acco .panel {padding:10px;box-sizing:border-box;}
  .agree-area .acco .panel .checkbox {padding:5px;}
  .agree-area .acco + .acco {margin-top:20px;}
  .fixed-button {padding:10px;background:#eee;text-align:center;font-size:14px;font-weight:bold;}
  .fixed-button .next-button {width:200px;padding:10px;background:#ddd;color:#000;}
  .fixed-button .next-button.-disabled {background:#fafafa;color:#ccc;}
  .fixed-button .next-button.-on {padding:10px;background:#000;color:#fff;}
</style>

</head>
<body>
  <h1>aa</h1>
  <div class="content">
    <div class="agree-area">
      <div class="allchk-button">
        <button type="button">
          <input type="checkbox" id="allchk" />
            <label for="allchk">전체동의</label>
        </button>
      </div>
      <div class="agree-acco">
        <div class="acco chk-import chk-import1 -active">
          <div class="title">
            <div class="checkbox">
              <input type="checkbox" id="mainchk01" />
              <label for="mainchk01">필수동의</label>
            </div>
          </div>
          <div class="panel">
            <div class="checkboxs -sub">
              <div class="checkbox">
                <input type="checkbox" id="chksub01" />
                <label for="chksub01">필수동의 약관1</label>
              </div>
              <div class="checkbox">
                <input type="checkbox" id="chksub02" />
                <label for="chksub02">필수동의 약관2</label>
              </div>
              <div class="checkbox">
                <input type="checkbox" id="chksub03" />
                <label for="chksub03">필수동의 약관3</label>
              </div>
              <div class="checkbox">
                <input type="checkbox" id="chksub04" />
                <label for="chksub04">필수동의 약관4</label>
              </div>
              <div class="checkbox">
                <input type="checkbox" id="chksub05" />
                <label for="chksub05">필수동의 약관5</label>
              </div>
            </div>
          </div>
        </div>
        <div class="acco chk-import chk-import2 -active">
          <div class="title">
            <div class="checkbox">
              <input type="checkbox" id="mainchk02" />
              <label for="mainchk02">선택동의</label>
            </div>
          </div>
          <div class="panel">
            <div class="checkboxs -sub">
              <div class="checkbox">
                <input type="checkbox" id="bchksub01" />
                <label for="bchksub01">선택동의 약관1</label>
              </div>
              <div class="checkbox">
                <input type="checkbox" id="bchksub02" />
                <label for="bchksub02">선택동의 약관2</label>
              </div>
              <div class="checkbox">
                <input type="checkbox" id="bchksub03" />
                <label for="bchksub03">선택동의 약관3</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="fixed-button">
        <button type="button" class="next-button -disabled" disabled>다음</button>
      </div>
    </div>
  </div>
</body>
<script>
const allchkBtn = document.querySelector('#allchk'); // 전체동의 checkbox 
const mainChk1 = document.querySelector('#mainchk01'); // 필수동의 checkbox 
const mainChk2 = document.querySelector('#mainchk02'); // 선택동의 checkbox

const nextBtn = document.querySelector('.next-button'); // 다음 버튼
const acco1 = document.querySelector('.chk-import1'); // 필수동의 하위 영역 
const acco2 = document.querySelector('.chk-import2'); // 선택동의 하위 영역 

const mainSubChk1 = document.querySelectorAll('.chk-import1 .checkboxs.-sub .checkbox input[type="checkbox"]'); // 필수동의 하위 5개 check
const mainSubChk2 = document.querySelectorAll('.chk-import2 .checkboxs.-sub .checkbox input[type="checkbox"]'); // 선택동의 하위 3개 check
const allCheckboxes = document.querySelectorAll('.checkboxs .checkbox input[type="checkbox"]'); // 필수동의 내부 5개 + 선택동의 내부 3개 checkbox 배열
// allCheckboxes 보다는 innerCheckboxes 등 이름이 맞을거같음 -> 하단 변수들을 배열로 합친 [...mainSumChk1, ...mainSubChk2] 로 해줘도됨

// 버튼 동작 가능한지 여부 확인용 이벤트 리스너
nextBtn.addEventListener('click', () => {
  alert("hello");
});

// 'change'는 상태가 변경되는 것을 감지하는 이벤트 
allchkBtn.addEventListener('change', allChkStatus);

mainChk1.addEventListener('change', () => {
  mainChkStatus(mainChk1, mainSubChk1);
  setAccoStatus();
});
mainChk2.addEventListener('change', () => {
  mainChkStatus(mainChk2, mainSubChk2);
  setAccoStatus();
});
mainSubChk1.forEach(checkbox => checkbox. addEventListener('change', checkSubChk1Status));
mainSubChk2.forEach(checkbox => checkbox.addEventListener('change', checkSubChk2Status));

function allChkStatus(event) {
  [mainChk1, mainChk2, ...mainSubChk1, ...mainSubChk2].forEach(checkbox => checkbox.checked = event.target.checked);
  setAccoStatus()
  updateNextButtonStatus()
}


function mainChkStatus(mainChk, subChks) {
  subChks.forEach(checkbox => checkbox.checked = mainChk.checked);
  updateAllChkStatus();
}

function updateAllChkStatus() {
  const isAllChecked = mainChk1.checked && mainChk2.checked;
  allchkBtn.checked = isAllChecked;
  updateNextButtonStatus()
}

function updateNextButtonStatus() {
  if (allchkBtn.checked) {
    nextBtn.disabled = false;
    nextBtn.classList.remove('-disabled')
    nextBtn.classList.add('-on');
  } else {
    nextBtn.disabled = true;
    nextBtn.classList.remove('-on');
    nextBtn.classList.add('-disabled');
  }
}

function checkSubChk1Status() {
  let isAllChecked = true;
  for (let checkbox of mainSubChk1) {
    if (!checkbox.checked) {
      isAllChecked = false;
      break;
    }
  }
  mainChk1.checked = isAllChecked;
  allchkBtn.checked = isAllChecked && mainChk1.checked && mainChk2.checked;
  setAccoStatus()
  updateNextButtonStatus();
}

function checkSubChk2Status() {
  let isAllChecked = true;
  for (let checkbox of mainSubChk2) {
    if (!checkbox.checked) {
      isAllChecked = false;
      break;
    }
  }
  mainChk2.checked = isAllChecked;
  allchkBtn.checked = isAllChecked && mainChk2.checked && mainChk1.checked;
  setAccoStatus()
  updateNextButtonStatus();
}

function setAccoStatus() {
  // mainChk1과 mainChk2의 상태에 따라 acco1과 acco2의 클래스를 조절
  if (mainChk1.checked) {
    acco1.classList.remove('-active');
  } else {
    acco1.classList.add('-active');
  }

  if (mainChk2.checked) {
    acco2.classList.remove('-active');
  } else {
    acco2.classList.add('-active');
  }
}
</script>
</html>